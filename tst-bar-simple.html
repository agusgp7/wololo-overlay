<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>RBW Bar Simple - Top 25</title>
  <style>
    html,body{margin:0;background:transparent;font-family:Arial,Helvetica,sans-serif;}

    .bar{
      width:1920px;height:90px;
      display:flex;align-items:center;
      padding:0 30px;
      background:rgba(0,0,0,.75);
      color:#fff;
      border-top:1px solid rgba(255,255,255,.12);
      border-bottom:1px solid rgba(255,255,255,.12);
      overflow:hidden;
      box-sizing:border-box;
    }

    .items{
      width:100%;
      display:flex;
      gap:18px;
      align-items:center;
      white-space:nowrap;
      font-size:26px;
      font-weight:900;
      min-width:0;
    }

    .item{display:flex;gap:10px;align-items:center;min-width:0;}
    .rk{opacity:.99;}
    .flag{width:38px;height:25px;border-radius:3px;flex:0 0 auto;object-fit:cover;}
    .nm{max-width:240px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
    .elo{opacity:.9;font-weight:800;}
    .sep{opacity:.35;margin:0 6px;}

    .muted{opacity:.85;font-weight:900;}
  </style>
</head>
<body>
  <div class="bar">
    <div class="items" id="items">Actualizando…</div>
  </div>

<script>
// ✅ Pedimos al backend hasta 250 para asegurar que hay al menos 25
const API = "https://wololo-backend.onrender.com/ranking?limit=250";
const REFRESH_MS = 10000;

// ✅ Duración de cada pantalla (ajustá a gusto)
const PAGE_MS = 1000; // 15s cada bloque: 1–5, 6–10, 11–15, 16–20, 21–25

let last = [];     // ranking completo que trae el backend
let page = 0;      // 0..4
let timer = null;

function esc(s){return String(s??"").replace(/[&<>"']/g,m=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[m]));}

// Flags PNG (OBS-safe)
function ccToTwemojiPng(cc){
  if(!cc || String(cc).length !== 2) return "";
  const up = String(cc).toUpperCase();
  const A = "A".charCodeAt(0);
  const cp1 = 0x1F1E6 + (up.charCodeAt(0) - A);
  const cp2 = 0x1F1E6 + (up.charCodeAt(1) - A);
  return `https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/72x72/${cp1.toString(16)}-${cp2.toString(16)}.png`;
}
function flagImgHtml(cc){
  const url = ccToTwemojiPng(cc);
  if(!url) return "";
  return `<img class="flag" src="${url}" alt="${esc(cc)}" />`;
}

function renderTop(start){
  const el = document.getElementById("items");
  if(!last.length){
    el.innerHTML = `<span class="muted">Sin datos</span>`;
    return;
  }

  // ✅ necesitamos al menos 25 para la última pantalla
  if(last.length < 25){
    el.innerHTML = `<span class="muted">Cargando ranking… (${last.length}/25)</span>`;
    return;
  }

  const slice = last.slice(start, start + 5);

  // ✅ ESTÁTICO (sin animación)
  el.innerHTML = slice.map(x => `
    <span class="item">
      <span class="rk">#${esc(x.rank)}</span>
      ${flagImgHtml(x.country)}
      <span class="nm">${esc(x.name)}</span>
      <span class="sep">•</span>
      <span class="elo">${esc(x.elo)}</span>
    </span>
  `).join(`<span class="sep">|</span>`);
}

function render(){
  // page 0..4 → start 0,5,10,15,20
  const start = page * 5;
  renderTop(start);
}

function scheduleNext(){
  clearTimeout(timer);
  timer = setTimeout(() => {
    page = (page + 1) % 5;
    render();
    scheduleNext();
  }, PAGE_MS);
}

async function tick(){
  try{
    const r = await fetch(API,{cache:"no-store"});
    if(!r.ok) throw new Error("HTTP " + r.status);
    const j = await r.json();
    last = Array.isArray(j) ? j : [];
    render();
  }catch(e){
    // no borres datos si ya había (evita parpadeo en OBS)
    if(!last.length){
      last = [];
      render();
    }
  }
}

// init
tick();
scheduleNext();
setInterval(tick, REFRESH_MS);
</script>
</body>
</html>



